pipelines:
  - name: cicd_go_backend
    configuration:
      runtime:
        type: image
        image:
          auto:
            language: go
            versions:
              - "1.12.14" # this is required for ubuntu16 node pool
    steps:
      # Build the Go sample app from the GitRepo
      - name: cicd_go_build
        type: GoBuild
        configuration:
          affinityGroup: goGroup
          sourceLocation: .
          repository: cicd-go
          outputLocation: /tmp/dist
          outputFile: go_backend
          inputResources:
            - name: cicd_go_backend_gitrepo
          integrations:
            - name: myArtifactory
             
      # Publish the Go sample app binary to Artifactory
      - name: cicd_go_publish_binary
        type: GoPublishBinary
        configuration:
          affinityGroup: goGroup
          inputSteps:
            - name: cicd_go_build
          targetRepository: cicd-generic
          integrations:
            - name: myArtifactory
             
      # Publish the Go sample app build info
      - name: cicd_publish_build_info
        type: PublishBuildInfo
        configuration:
          affinityGroup: goGroup
          inputSteps:
            - name: cicd_go_publish_binary
          outputResources:
            - name: cicd_go_backend_buildinfo
             
      # Publish the Go module from the GitRepo
      - name: cicd_go_publish_module
        type: GoPublishModule
        configuration:
          sourceLocation: .
          version: v0.0.0
          targetRepository: cicd-go-local
          autoPublishBuildInfo: true
          integrations:
            - name: myArtifactory
          inputResources:
            - name: cicd_go_backend_gitrepo
          outputResources:
            - name: cicd_go_backend_buildinfo_module
